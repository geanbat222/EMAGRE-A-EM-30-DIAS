<script>
document.addEventListener('DOMContentLoaded', function () {
  const form = document.getElementById('quiz');
  const perguntas = Array.from(document.querySelectorAll('.q'));
  const bar = document.getElementById('bar');
  const btnNext = document.getElementById('proximo');
  const btnPrev = document.getElementById('voltar');
  const result = document.getElementById('resultado');
  const rec = document.getElementById('recomendacao');
  const btnCheckout = document.getElementById('btnCheckout');

  // util
  const getAnswerByName = (name) => {
    const el = form.querySelector(input[name="${name}"]:checked);
    return el ? el.value : null;
  };
  const scrollToEl = (el) => el.scrollIntoView({ behavior: 'smooth', block: 'start' });

  // Se quiser navega√ß√£o passo a passo, deixe as perguntas ocultas inicialmente via CSS.
  // Aqui vamos aceitar todas vis√≠veis e apenas validar no fim.
  btnPrev.disabled = true; // n√£o usamos "voltar" nesse modo
  bar.style.width = '20%'; // s√≥ pra n√£o ficar zerado

  btnNext.addEventListener('click', function () {
    // nomes das perguntas na ordem
    const names = perguntas.map(q => q.dataset.q);

    // encontra a primeira n√£o respondida
    let primeiraNao = null;
    for (const n of names) {
      if (!getAnswerByName(n)) { primeiraNao = n; break; }
    }

    if (primeiraNao) {
      // avisa e rola at√© a pergunta que falta
      alert('Responda esta pergunta para continuar.');
      const alvo = perguntas.find(q => q.dataset.q === primeiraNao);
      if (alvo) scrollToEl(alvo);
      return;
    }

    // tudo respondido ‚Üí monta recomenda√ß√£o e mostra resultado
    const objetivo    = getAnswerByName('objetivo');
    const tempo       = getAnswerByName('tempo');
    const local       = getAnswerByName('local');
    const desafio     = getAnswerByName('desafio');
    const alimentacao = getAnswerByName('alimentacao');
    const nivel       = getAnswerByName('nivel');

    let texto = `Perfil detectado: `;
    texto += (nivel==='iniciante') ? 'Iniciante' : (nivel==='intermediario'?'Intermedi√°rio':'Avan√ßado');
    texto += ` ‚Ä¢ Objetivo: ${objetivo} ‚Ä¢ Tempo di√°rio: ${tempo} min ‚Ä¢ Local: ${local}.<br><br>`;
    texto += `üéØ Recomenda√ß√£o: siga o plano de 30 dias com `;
    texto += (tempo==='15') ? 'treinos de 15 minutos e card√°pio enxuto' :
             (tempo==='30' ? 'treinos de 20‚Äì30 minutos e card√°pio flex√≠vel' : 'treinos completos e varia√ß√µes avan√ßadas');
    texto += `, focando em `;
    texto += (desafio==='tempo') ? 'otimizar rotinas curtas' :
             (desafio==='ansiedade') ? 't√©cnicas de saciedade e controle da ansiedade' :
             (desafio==='disciplina') ? 'h√°bitos e metas semanais' : 'planejamento alimentar simples';
    texto += . Prefer√™ncia alimentar: ${alimentacao}.;

    rec.innerHTML = texto;

    // link do checkout com par√¢metros UTM
    const params = new URLSearchParams({
      objetivo, tempo, local, desafio, alimentacao, nivel, src: 'quiz'
    });
    const checkout = 'https://pay.hotmart.com/H101662874C'; // <-- troque aqui
    btnCheckout.href = checkout + (checkout.includes('?') ? '&' : '?') + params.toString();

    // exibe resultado
    form.style.display = 'none';
    result.style.display = 'block';
    bar.style.width = '100%';
    scrollToEl(result);
  });

  // salvar e-mail (opcional)
  const btnSave = document.getElementById('salvarEmail');
  if (btnSave) {
    btnSave.addEventListener('click', ()=>{
      const email = document.getElementById('email').value.trim();
      if(email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
        localStorage.setItem('quiz_email', email);
        alert('E-mail salvo! Vamos te enviar dicas √∫teis.');
      } else {
        alert('Digite um e-mail v√°lido (ou deixe em branco).');
      }
    });
  }
});
</script>
